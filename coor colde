(function() {
  window.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('.cq-RichText-toolbar').forEach(function(toolbar) {
      // Add button
      var btn = document.createElement('button');
      btn.type = "button";
      btn.title = "Text Color";
      btn.innerHTML = "ðŸŽ¨";
      btn.className = "rte-color-picker-btn";
      toolbar.appendChild(btn);

      btn.addEventListener('click', function(e) {
        var input = document.createElement('input');
        input.type = "color";
        input.className = "rte-color-picker-input";
        document.body.appendChild(input);
        input.click();
        input.addEventListener('input', function() {
          var color = input.value;
          var sel = window.getSelection();
          if(sel.rangeCount) {
            var range = sel.getRangeAt(0);
            var span = document.createElement('span');
            span.style.color = color;
            range.surroundContents(span);
          }
          input.remove();
        });
        input.addEventListener('blur', function() { input.remove(); });
        e.preventDefault();
      });
    });
  });
})();